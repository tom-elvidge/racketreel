# Contributing

## Postgres

A local Postgres database can be started for development with Docker.

```sh
docker compose -f postgres.docker-compose.yaml up -d
```

The connection configuration from the application to this database is already configured in `appsettings.Development.json`.

All the database configuration is done the first time the application is started.

```sh
dotnet run
```

## OpenAPI

Building the .NET solution will use Swashbuckle to generate an OpenAPI specification, outputting it to `Matches.Infrastructure/wwwroot/openapi/v1`.

```sh
dotnet build
```

This can be navigated with the Swagger Viewer by running the application in debug mode and navigating to `https://localhost:5012/openapi/index.html`.

```sh
dotnet run
```

## Dart Client

A Dart client can be generated automatically from the OpenAPI specification generated by Swashbuckle.

Install the OpenAPI Generator CLI.

```sh
npm install @openapitools/openapi-generator-cli -g
```

Bump the version in `openapitools.json` and `Matches.Infrastructure/Program.cs` so that they match.

Then run the `generate` command. This will use the configuration in `openapitools.json` and output the generated code to `Client/Dart`.

```sh
openapi-generator-cli generate
```

Update `Dart/Client/CHANGELOG.md` with the new version. Some adjustments may have to be made to the generated code to ensure it compiles.

Publish the client.

```sh
dart pub publish
```

## Deployment

Install `gcloud`  and login

```sh
gcloud auth login
```

I have already created a project in with the id `tomelvidge` for POC projects so set this as the current project

```sh
gcloud config set project tomelvidge
```

Deploy the application to Cloud Run from source

```sh
gcloud run deploy racketreel-matches \
	--source=./ \
	--region=europe-west1 \
	--min-instances=0 \
	--max-instances=4 \
	--allow-unauthenticated \
	--set-env-vars='DatabaseConfig__Host'='...','DatabaseConfig__Port'='...','DatabaseConfig__Username'='...','DatabaseConfig__Password'='...','DatabaseConfig__Database'='...','AuthConfig__Authority'='...','AuthConfig__Audience'='...'
```